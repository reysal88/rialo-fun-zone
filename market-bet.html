<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Market Bet Fun Stable</title>
<style>
body { margin:0; font-family:Arial,sans-serif; background:#000; color:#fff;}
header { padding:10px 20px; font-size:1.5em;}
#wallet { position: fixed; top:10px; right:20px; font-weight:bold;}
.market-container { display:grid; grid-template-columns: repeat(3, 1fr); gap:15px; margin:60px 10px 10px 10px;}
.market-container .bottom-row { grid-column: span 3; display:grid; grid-template-columns: repeat(2, 1fr); gap:15px;}
.market-box { background:#1a1a1a; padding:15px; border-radius:8px; text-align:center;}
.market-box h2 { margin:0 0 10px 0; cursor:pointer;}
.bet-row { display:flex; justify-content:space-between; align-items:center; margin-top:10px;}
.bet-row button { padding:5px 10px; cursor:pointer;}
#parlay-box, #history-box { background:#222; padding:15px; border-radius:8px; margin:20px; max-height:300px; overflow-y:auto;}
#parlay-box h3, #history-box h3 { margin-top:0;}
.parlay-item, .history-item { margin-bottom:5px; border-bottom:1px solid #333; padding:5px 0;}
input[type="number"] { width:60px;}
button:disabled { opacity:0.5; cursor:not-allowed;}
.modal { display:none; position:fixed; z-index:100; left:0; top:0; width:100%; height:100%; overflow:auto; background:rgba(0,0,0,0.7);}
.modal-content { background:#1a1a1a; margin:10% auto; padding:20px; border-radius:10px; width:300px;}
.modal-content label { display:block; margin:5px 0;}
.modal-content button { margin-top:10px; padding:5px 10px;}
</style>
</head>
<body>

<header>Market Bet Fun</header>
<div id="wallet">Your Credit: <span id="rlo">1000</span> RLO</div>

<div class="market-container" id="markets"></div>

<div id="parlay-box">
  <h3>Parlay List</h3>
  <div id="parlay-list"></div>
  <label>Amount for Parlay: <input type="number" id="parlay-amount" min="1"></label>
  <button id="confirm-parlay" disabled>Confirm Parlay</button>
</div>

<div id="history-box">
  <h3>History Bet</h3>
  <h4>Running</h4>
  <div id="history-running"></div>
  <h4>Completed</h4>
  <div id="history-completed"></div>
</div>

<!-- Modal untuk single/parlay -->
<div id="betModal" class="modal">
  <div class="modal-content">
    <h3>Place Bet</h3>
    <label><input type="radio" name="betType" value="single"> Single Bet</label>
    <label><input type="radio" name="betType" value="parlay"> Parlay</label>
    <div id="singleAmountDiv" style="margin-top:10px; display:none;">
      Amount: <input type="number" id="singleAmount" min="1">
    </div>
    <button id="confirmBet">Confirm</button>
  </div>
</div>

<script>
// --- Wallet & Storage ---
let wallet = localStorage.getItem('wallet') ? parseInt(localStorage.getItem('wallet')) : 1000;
document.getElementById('rlo').innerText = wallet;

let historyCompleted = localStorage.getItem('historyCompleted') ? JSON.parse(localStorage.getItem('historyCompleted')) : [];
let historyRunning = localStorage.getItem('historyRunning') ? JSON.parse(localStorage.getItem('historyRunning')) : [];
let parlayList = localStorage.getItem('parlayList') ? JSON.parse(localStorage.getItem('parlayList')) : [];

function saveState(){
  localStorage.setItem('wallet', wallet);
  localStorage.setItem('historyCompleted', JSON.stringify(historyCompleted));
  localStorage.setItem('historyRunning', JSON.stringify(historyRunning));
  localStorage.setItem('parlayList', JSON.stringify(parlayList));
}

// --- Render ---
const historyRunningDiv = document.getElementById('history-running');
const historyCompletedDiv = document.getElementById('history-completed');
const parlayDiv = document.getElementById('parlay-list');

function renderHistory(){
  historyRunningDiv.innerHTML=''; historyCompletedDiv.innerHTML='';
  historyRunning.forEach(h=>{
    const div=document.createElement('div'); div.className='history-item';
    div.innerText=`[ID:${h.id}] ${h.type==='single'?'Single':'Parlay'} ${h.market||h.markets.map(m=>m.market).join(',')} ${h.direction||''} ${h.amount} RLO`;
    historyRunningDiv.appendChild(div);
  });
  historyCompleted.forEach(h=>{
    const div=document.createElement('div'); div.className='history-item';
    div.innerText=`[ID:${h.id}] ${h.type==='single'?'Single':'Parlay'} ${h.market||h.markets.map(m=>m.market).join(',')} Won ${h.winAmount||0} RLO`;
    historyCompletedDiv.appendChild(div);
  });
}

function renderParlay(){
  parlayDiv.innerHTML='';
  parlayList.forEach(p=>{
    const div=document.createElement('div');
    div.className='parlay-item';
    div.innerText=`${p.market} - ${p.direction.toUpperCase()}`;
    parlayDiv.appendChild(div);
  });
  document.getElementById('confirm-parlay').disabled = parlayList.length<1;
}

renderHistory();
renderParlay();

// --- Market ---
const marketsTop = ['BTC','ETH','SOL'];
const marketsBottom = ['BNB','AVAX'];
let marketData={BTC:0,ETH:0,SOL:0,BNB:0,AVAX:0};
const marketsDiv=document.getElementById('markets');

async function fetchPrices(){
  try{
    const res=await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana,binancecoin,avalanche-2&vs_currencies=usd');
    const data=await res.json();
    if(data.bitcoin) marketData.BTC=parseFloat(data.bitcoin.usd);
    if(data.ethereum) marketData.ETH=parseFloat(data.ethereum.usd);
    if(data.solana) marketData.SOL=parseFloat(data.solana.usd);
    if(data.binancecoin) marketData.BNB=parseFloat(data.binancecoin.usd);
    if(data['avalanche-2']) marketData.AVAX=parseFloat(data['avalanche-2'].usd);
    renderMarkets();
  }catch(err){ console.error('Fetch harga gagal:',err);}
}

function renderMarkets(){
  marketsDiv.innerHTML='';
  // Top row
  marketsTop.forEach(m=>{ createMarketBox(m); });
  // Bottom row
  const bottomRow = document.createElement('div'); bottomRow.className='bottom-row';
  marketsBottom.forEach(m=>{ createMarketBox(m, bottomRow); });
  marketsDiv.appendChild(bottomRow);
}

function createMarketBox(market, parent){
  const box = document.createElement('div'); box.className='market-box';
  const h2 = document.createElement('h2'); h2.innerText=`${market} ${marketData[market].toFixed(2)} USD`; box.appendChild(h2);
  const targetUp = (marketData[market]*1.0008).toFixed(2);
  const row = document.createElement('div'); row.className='bet-row';
  const span = document.createElement('span'); span.innerText=`WILL UP TO ${targetUp} IN 2 MIN?`;
  const yesBtn=document.createElement('button'); yesBtn.innerText='YES'; yesBtn.onclick=()=>openBetModal(market,'up');
  const noBtn=document.createElement('button'); noBtn.innerText='NO'; noBtn.onclick=()=>openBetModal(market,'down');
  row.appendChild(span); row.appendChild(yesBtn); row.appendChild(noBtn);
  box.appendChild(row);
  if(parent) parent.appendChild(box); else marketsDiv.appendChild(box);
}

// --- Modal ---
let currentBetMarket='', currentBetDirection='';
const modal=document.getElementById('betModal');
const betRadios=document.getElementsByName('betType');
const singleAmountDiv=document.getElementById('singleAmountDiv');
const singleAmountInput=document.getElementById('singleAmount');

betRadios.forEach(r=>r.addEventListener('change',()=>{ singleAmountDiv.style.display=r.value==='single'?'block':'none'; }));

function openBetModal(market,direction){ currentBetMarket=market; currentBetDirection=direction; modal.style.display='block'; }

document.getElementById('confirmBet').onclick=()=>{
  const selectedType = Array.from(betRadios).find(r=>r.checked)?.value;
  if(!selectedType){ alert('Choose Single or Parlay'); return; }
  const betID = Date.now()+'-'+Math.floor(Math.random()*1000);

  if(selectedType==='single'){
    const amt=parseInt(singleAmountInput.value);
    if(isNaN(amt)||amt<=0||amt>wallet){ alert('Invalid amount'); return; }
    wallet-=amt; saveState(); document.getElementById('rlo').innerText=wallet;

    const runningBet = { id:betID, type:'single', market:currentBetMarket, direction:currentBetDirection, amount:amt, startTime:Date.now(), duration:2*60*1000, text:''};
    historyRunning.push(runningBet); saveState(); renderHistory();

    setTimeout(()=>{
      const winAmt = amt*2;
      wallet+=winAmt;
      historyCompleted.push({...runningBet, winAmount:winAmt});
      historyRunning=historyRunning.filter(b=>b.id!==betID);
      saveState(); renderHistory(); document.getElementById('rlo').innerText=wallet;
    }, runningBet.duration);

  } else if(selectedType==='parlay'){
    if(!parlayList.find(p=>p.market===currentBetMarket)){ parlayList.push({market:currentBetMarket,direction:currentBetDirection}); saveState(); renderParlay(); }
  }
  modal.style.display='none';
};

window.onclick=function(event){ if(event.target==modal){ modal.style.display='none'; } };

// --- Parlay Confirm ---
document.getElementById('confirm-parlay').onclick=()=>{
  const amt=parseInt(document.getElementById('parlay-amount').value);
  if(isNaN(amt)||amt<=0||amt>wallet){ alert('Invalid amount'); return; }
  wallet-=amt; document.getElementById('rlo').innerText=wallet;

  const betID = Date.now()+'-'+Math.floor(Math.random()*1000);
  const duration = 2*60*1000;

  const runningBet = { id:betID, type:'parlay', markets:[...parlayList], amount:amt, startTime:Date.now(), duration:duration };
  historyRunning.push(runningBet); saveState(); renderHistory();

  setTimeout(()=>{
    const winAmt = amt*2*parlayList.length;
    wallet+=winAmt;
    historyCompleted.push({...runningBet, winAmount:winAmt});
    historyRunning = historyRunning.filter(b=>b.id!==betID);
    saveState(); renderHistory(); document.getElementById('rlo').innerText=wallet;
  }, duration);

  parlayList=[]; document.getElementById('parlay-amount').value=''; saveState(); renderParlay();
}

// --- Start ---
fetchPrices(); setInterval(fetchPrices,1000);
</script>
</body>
</html>
